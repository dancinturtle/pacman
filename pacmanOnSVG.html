<html>
<head>
 <title>Pacman on SVG</title>
 <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
  <div id="stats">
    <div class="textblock">
      <p id="lives">1 UP</p>
      <p id="score">0</p>
    </div>
    <div class="textblock">
      <p>HIGH SCORE</p>
      <p align="right">1500</p>
    </div>
  </div>

 <svg id="svg" xmlns="http://www.w3.org/2000/svg">
<!--
   <rect class="obstacleRec" x="130" y="55" rx="10" ry="10"></rect>
   <polygon class="obstacleL" points="77,55 77,170 170,170 170,133 97,133 97,55"></polygon> -->
   <image id="pacman" xlink:href="pacman.gif" height="20px" width="20px"></image>
   <image id="blinky" xlink:href="blinky.gif" height="25px" width="25px"></image>
   <image id="clyde" xlink:href="clyde.gif" height="25px" width="25px"></image>
   <image id="inky" xlink:href="inky.gif" height="25px" width="25px"></image>
   <image id="pinky" xlink:href="pinky.gif" height="25px" width="25px"></image>


 </svg>

 <script>

var boundaries = [];
var coins = [];
var player = document.getElementById('pacman');

var pacman = {
   x: 13.5,
   y: 23,
   score: 0
 }
function Ghost(name, x, y){
  this.name = name,
  this.x = x,
  this.y = y,
  this.dx= null,
  this.dy = null,
  this.float = function(){
    if(pacman.y < this.y){
      this.dy = -0.25;
    }
    if(pacman.y > this.y){
      this.dy = 0.25;
    }
    this.x += this.dx;
    this.y += this.dy;
    console.log("new coords", this.x, this.y);
    displayGhosts(ghosts);
    // el.setAttribute("x", this.x);
    // el.setAttribute("y", this.y);
  }
}

var blinky = new Ghost("blinky", 13.5, 11.5);
var clyde = new Ghost("clyde", 11.5, 14);
var pinky = new Ghost("pinky", 13.5, 14);
var inky = new Ghost("inky", 15.5, 14);
var ghosts= [blinky, clyde, pinky, inky];

function displayGhosts(array){
  for(var i=0; i<array.length; i++){

    document.getElementById(array[i].name).style.y=array[i].y*25;
    document.getElementById(array[i].name).style.x=array[i].x*25;
  }
}
displayGhosts(ghosts);

function displayPacman(){
   document.getElementById('pacman').style.y = pacman.y*25;
   document.getElementById('pacman').style.x = pacman.x*25;
   console.log("player", player.style.x, player.style.y);
 }

displayPacman();

document.onkeydown = function(e){
   console.log(e.keyCode);
   //pacmanright
   if(e.keyCode == 39 && coinsMap[pacman.y][pacman.x+1]==3){
     pacman.x = 1;
   }
   else if(e.keyCode == 39 && coinsMap[pacman.y][pacman.x+1]!=9){
     pacman.x = Math.floor(pacman.x) + 1;
   }
   //ghostright
   else if(e.keyCode == 76){
     blinky.x = Math.ceil(blinky.x) + 1;
   }
   //pacmanleft
   else if(e.keyCode == 37 && coinsMap[pacman.y][pacman.x-1]==3){
     pacman.x = 26;
     pacman.y=15;
   }
   //ghostleft
   else if(e.keyCode==74){
     blinky.x = Math.ceil(blinky.x)-1;
   }
   else if (e.keyCode == 37 && coinsMap[pacman.y][pacman.x-1]!=9){
     pacman.x = Math.ceil(pacman.x) - 1;
    //  pacman.x--;
   }
   //pacmanup
   else if (e.keyCode == 38 && coinsMap[pacman.y-1][Math.floor(pacman.x)]!=9){

     pacman.y--;
   }
   //ghostup
   else if(e.keyCode==73){
     blinky.y = Math.ceil(blinky.y)-1;
   }
   //pacmandown
   else if (e.keyCode == 40 && coinsMap[pacman.y+1][Math.floor(pacman.x)]!=9){

     pacman.y++;
   }
   //ghostdown
   else if(e.keyCode==75){
     blinky.y = Math.floor(blinky.y)+1;
   }
   console.log("Pacman", pacman);
   displayPacman();
   displayGhosts(ghosts);
   detectCoinCollection();

 }
 function floatingghost(ghost, dx, dy){
   //respond to where pacman is

   ghost.x += dx;
   ghost.y += dy;
   displayGhosts(ghosts);
 }
 setInterval("blinky.float()", 100);

 function Borders(coorda, coordb, coordc, coordd){
   this.info = {coorda:coorda, coordb:coordb, coordc: coordc, coordd:coordd, style: "stroke: white; fill: none; stroke-width: 6;"};
   this.initialize = function(){
     var border = makeSVG('polyline',
      { points: this.info.coorda + " " + this.info.coordb + " " + this.info.coordc + " " + this.info.coordd,
        style: this.info.style
      });
    document.getElementById('svg').appendChild(border);
   }
   var makeSVG = function(tag, attrs) {
         var el= document.createElementNS('http://www.w3.org/2000/svg', tag);
         for (var k in attrs)
         {
             el.setAttribute(k, attrs[k]);
         }
         return el;
     } //closes makeSVG

     this.initialize();
 }
 var outerBorderTop = new Borders("0, 350", "0,0", "700, 0", "700, 360");
 var outerBorderBottom = new Borders("0, 400", "0, 765", "700, 765", "700, 400");
 var ghostBoxLeft = new Borders("320, 320", "270, 320", "270, 400", "350, 400");
 var ghostBoxRight = new Borders("350, 400", "430, 400", "430, 320", "380, 320");
 // var ghostBox = new Borders(500, 500, 300, 300);

 function Rectangle(x, y, width, height){
   this.info = {x: x, y: y, width: width, height: height, rx: 10, ry: 10, style: "fill: blue; stroke: yellow; stroke-width: 2;"};
   this.initialize = function(){
     var rectangle = makeSVG('rect',
       { x: this.info.x,
         y: this.info.y,
         rx: this.info.rx,
         ry: this.info.ry,
         width: this.info.width,
         height: this.info.height,
         style: this.info.style
       });
    document.getElementById('svg').appendChild(rectangle);
  }
  var makeSVG = function(tag, attrs) {
        var el= document.createElementNS('http://www.w3.org/2000/svg', tag);
        for (var k in attrs)
        {
            el.setAttribute(k, attrs[k]);
        }
        boundaries.push(el);
        return el;
    } //closes makeSVG

    this.initialize();
 }

 function ObstacleL(coorda, coordb, coordc, coordd, coorde, coordf){
   this.info = {coorda: coorda, coordb: coordb, coordc: coordc, coordd: coordd, coorde: coorde, coordf: coordf, style: "fill: blue; stroke: yellow; stroke-width: 2; stroke-linejoin: round;"};
   this.initialize = function(){
     var obstacleL = makeSVG('polygon',
       { points: this.info.coorda + " " + this.info.coordb + " " + this.info.coordc + " " + this.info.coordd + " " + this.info.coorde + " " + this.info.coordf,
         style: this.info.style
       });
    document.getElementById('svg').appendChild(obstacleL);
  }
  var makeSVG = function(tag, attrs) {
        console.log("attrs", attrs);
        var el= document.createElementNS('http://www.w3.org/2000/svg', tag);
        for (var k in attrs)
        {
            el.setAttribute(k, attrs[k]);
        }
        boundaries.push(el);
        return el;
    } //closes makeSVG

    this.initialize();
 }
 function ObstacleU(coorda, coordb, coordc, coordd, coorde, coordf, coordg, coordh){
   this.info = {coorda: coorda, coordb: coordb, coordc: coordc, coordd: coordd, coorde: coorde, coordf: coordf, coordg: coordg, coordh: coordh, style: "fill: blue; stroke: yellow; stroke-width: 2; stroke-linejoin: round;"};
   this.initialize = function(){
     var obstacleL = makeSVG('polygon',
       { points: this.info.coorda + " " + this.info.coordb + " " + this.info.coordc + " " + this.info.coordd + " " + this.info.coorde + " " + this.info.coordf + " " + this.info.coordg + " " + this.info.coordh,
         style: this.info.style
       });
    document.getElementById('svg').appendChild(obstacleL);
  }
  var makeSVG = function(tag, attrs) {
        console.log("attrs", attrs);
        var el= document.createElementNS('http://www.w3.org/2000/svg', tag);
        for (var k in attrs)
        {
            el.setAttribute(k, attrs[k]);
        }
        boundaries.push(el);
        return el;
    } //closes makeSVG

    this.initialize();
 }
 var oneL = new ObstacleL("50, 50", "50, 195", "148, 195", "148, 150", "98, 150", "98, 50");
 var twoL = new ObstacleL("600, 50", "600, 150", "550, 150", "550, 195", "645, 195", "645, 50");
 var threeL = new ObstacleL("100, 475", "100, 570", "220, 570", "220, 525", "145, 525", "145, 475");
 var fourL = new ObstacleL("175, 400", "175, 495", "295, 495", "295, 450", "220, 450", "220, 400");
 var fiveL = new ObstacleL("475, 400", "475, 450", "400, 450", "400, 495", "520, 495", "520, 400");
 var sixL = new ObstacleL("550, 475", "550, 525", "475, 525", "475, 570", "595, 570", "595, 475");
 var sevenL = new ObstacleL("50, 600", "50, 720", "95, 720", "95, 645", "145, 645", "145, 600");
 var eightL = new ObstacleL("550, 600", "550, 645", "600, 645", "600, 720", "645, 720", "645, 600");
 //rectangle(x, y, width, height);
 var oneR = new Rectangle(125, 50, 95, 70);
 var twoR = new Rectangle(475, 50, 95, 70);
 var threeR = new Rectangle(25, 225, 45, 120);
 var fourR = new Rectangle(625, 225, 45, 145);
 var fiveR = new Rectangle(325, 675, 45, 70);
 var sixR = new Rectangle(250, 600, 195, 45);
 var oneU = new ObstacleU("250, 50", "250, 195", "295, 195", "295, 95", "400, 95", "400, 195", "445, 195", "445, 50");
 var twoU = new ObstacleU("175, 150", "175, 225", "100, 225", "100, 270", "175, 270", "175, 345", "220, 345", "220, 150");
 var threeU = new ObstacleU("325, 125", "325, 225", "250, 225", "250, 270", "445, 270", "445, 225", "370, 225", "370, 125");
 var fourU = new ObstacleU("475, 150", "475, 345", "520, 345", "520, 270", "595, 270", "595, 225", "520, 225", "520, 150");
 var fiveU = new ObstacleU("100, 300", "100, 400", "25, 400", "25, 570", "70, 570", "70, 445", "145, 445", "145, 300");
 var sixU = new ObstacleU("325, 450", "325, 525", "250, 525", "250, 570", "445, 570", "445, 525", "370, 525", "370, 450");
 var sevenU = new ObstacleU("550, 300", "550, 445", "625, 445", "625, 570", "670, 570", "670, 400", "595, 400", "595, 300");
 var eightU = new ObstacleU("175, 600", "175, 675", "125, 675", "125, 720", "295, 720", "295, 675", "220, 675", "220, 600");
 var nineU = new ObstacleU("475, 600", "475, 675", "400, 675", "400, 720", "570, 720", "570, 675", "520, 675", "520, 600");


 function MakeCoin(cx, cy, r){
   this.info = {cx: cx, cy: cy, r: r, style: "fill: yellow; stroke: white; stroke-width: 1;"};
   this.initialize = function(){
     var circle = makeSVG('circle',
      {cx: this.info.cx,
       cy: this.info.cy,
       r: this.info.r,
       style: this.info.style
      });
    document.getElementById('svg').appendChild(circle);
   }
   var makeSVG = function(tag, attrs) {
         var el= document.createElementNS('http://www.w3.org/2000/svg', tag);
         for (var k in attrs)
         {
             el.setAttribute(k, attrs[k]);
         }
         coins.push(el);
         return el;
     } //closes makeSVG

     this.initialize();
 }
 var coinsMap = [
   [9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9],
   [9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,9],
   [9,1,9,9,1,9,9,9,9,1,9,9,9,9,9,9,9,9,1,9,9,9,9,1,9,9,1,9],
   [9,2,9,9,1,9,9,9,9,1,9,9,9,9,9,9,9,9,1,9,9,9,9,1,9,9,2,9],
   [9,1,9,9,1,9,9,9,9,1,9,9,1,1,1,1,9,9,1,9,9,9,9,1,9,9,1,9],
   [9,1,9,9,1,1,1,1,1,1,9,9,1,9,9,1,9,9,1,1,1,1,1,1,9,9,1,9],
   [9,1,9,9,9,9,1,9,9,1,9,9,1,9,9,1,9,9,1,9,9,1,9,9,9,9,1,9],
   [9,1,9,9,9,9,1,9,9,1,9,9,1,9,9,1,9,9,1,9,9,1,9,9,9,9,1,9],
   [9,1,1,1,1,1,1,9,9,1,1,1,1,9,9,1,1,1,1,9,9,1,1,1,1,1,1,9],
   [9,9,9,1,9,9,9,9,9,0,9,9,9,9,9,9,9,9,0,9,9,9,9,9,1,9,9,9],
   [9,9,9,1,9,9,9,9,9,0,9,9,9,9,9,9,9,9,0,9,9,9,9,9,1,9,9,9],
   [9,9,9,1,1,1,1,9,9,0,0,0,0,0,0,0,0,0,0,9,9,1,1,1,1,9,9,9],
   [9,9,9,0,9,9,1,9,9,0,9,9,9,9,9,9,9,9,0,9,9,1,9,9,0,9,9,9],
   [9,9,9,0,9,9,1,9,9,0,9,0,0,0,0,0,0,9,0,9,9,1,9,9,0,9,9,9],
   [3,0,0,0,9,9,1,0,0,0,9,0,0,0,0,0,0,9,0,0,0,1,9,9,0,9,9,9],
   [3,0,0,0,9,9,1,0,0,0,9,0,0,0,0,0,0,9,0,0,0,1,9,9,0,0,0,3],
   [9,9,9,9,9,9,1,9,9,0,9,9,9,9,9,9,9,9,0,9,9,1,9,9,9,9,9,9],
   [9,9,9,9,9,9,1,9,9,0,0,0,0,0,0,0,0,0,0,9,9,1,9,9,9,9,9,9],
   [9,9,9,1,1,1,1,9,9,9,9,9,0,9,9,0,9,9,9,9,9,1,1,1,1,9,9,9],
   [9,9,9,1,9,9,1,9,9,9,9,9,0,9,9,0,9,9,9,9,9,1,9,9,1,9,9,9],
   [9,9,9,1,9,9,1,1,1,1,0,0,0,9,9,0,0,0,1,1,1,1,9,9,1,9,9,9],
   [9,9,9,1,9,9,9,9,9,1,9,9,9,9,9,9,9,9,1,9,9,9,9,9,1,9,9,9],
   [9,9,9,1,9,9,9,9,9,1,9,9,9,9,9,9,9,9,1,9,9,9,9,9,1,9,9,9],
   [9,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,9],
   [9,1,9,9,9,9,1,9,9,1,9,9,9,9,9,9,9,9,1,9,9,1,9,9,9,9,1,9],
   [9,1,9,9,9,9,1,9,9,1,9,9,9,9,9,9,9,9,1,9,9,1,9,9,9,9,1,9],
   [9,1,9,9,1,1,1,9,9,1,1,1,1,1,1,1,1,1,1,9,9,1,1,1,9,9,1,9],
   [9,2,9,9,1,9,9,9,9,9,9,9,1,9,9,1,9,9,9,9,9,9,9,1,9,9,2,9],
   [9,1,9,9,1,9,9,9,9,9,9,9,1,9,9,1,9,9,9,9,9,9,9,1,9,9,1,9],
   [9,1,1,1,1,1,1,1,1,1,1,1,1,9,9,1,1,1,1,1,1,1,1,1,1,1,1,9],
   [9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9]
 ]
 for (var i=0; i<coinsMap.length; i++){
   for(var j=0; j<coinsMap[i].length; j++){
     var x = 25*j+10;
     var y = 25*i+10;
     if(coinsMap[i][j] == 1){
       var r = 3;
       var newcoin = new MakeCoin(x, y, r);
     }
     else if(coinsMap[i][j] == 2){
       var r = 7;
       var newcoin = new MakeCoin(x, y, r);
     }
   }
 }

 function detectCoinCollection(){
   for(var i=0; i<coins.length; i++){
     if(Math.abs(coins[i].cx.animVal.value - player.style.x) <= 10 && Math.abs(coins[i].cy.animVal.value - player.style.y) <= 10){
       document.getElementById('svg').removeChild(coins[i]);
       pacman.score += 10;
       document.getElementById('score').innerHTML = pacman.score;
       removeAtIndex(coins, i);
     }
   }
 }

 function removeAtIndex(array, index){
   if(index == array.length-1){
     array.pop();
     return array;
   }
   else {
    var temp = array[index];
    for(var k=index; k<array.length-1; k++){
      array[k] = array[k+1];
    }
    array[array.length-1] = temp;
    array.pop();
    return array;
  }
 }

 </script>

</body>
</html>

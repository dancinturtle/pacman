<html>
<head>
 <title>Pacman on SVG</title>
 <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>

 <svg id="svg" xmlns="http://www.w3.org/2000/svg">
<!--
   <rect class="obstacleRec" x="130" y="55" rx="10" ry="10"></rect>
   <polygon class="obstacleL" points="77,55 77,170 170,170 170,133 97,133 97,55"></polygon> -->
   <image id="pacman" xlink:href="pacman.gif" height="20px" width="20px"></image>

 </svg>

 <script>
var world = [
  [1, 2]
];
var boundaries = [];
var coins = [];
var player = document.getElementById('pacman');
function displayWorld() {
  var output = "";
  for(var i=0; i<world.length; i++){
    output += "<div>";
    for(var j=0; j<world[i].length; j++){
      if(world[i][j] == 1){
        output += "<polygon class='obstacleL' points='77,55 77,170 170,170 170,133 97,133 97,55'></polygon>";
      }
      else if(world[i][j] == 2){
        output += "<rect class='obstacleRec' x='130' y='55' rx='10' ry='10'></rect>"
      }
    }
    output += "</div>";
  }
  console.log(output);
  document.getElementById('svg').innerHTML = output;
}



var pacman = {
   x: 13,
   y: 23
 }

function displayPacman(){
   document.getElementById('pacman').style.y = pacman.y*25;
   document.getElementById('pacman').style.x = pacman.x*25;
   console.log("player", player.style.x, player.style.y);
 }

displayPacman();

document.onkeydown = function(e){
   console.log(e.keyCode);
   //right
   if(e.keyCode == 39 && coinsMap[pacman.y][pacman.x+1]==3){
     pacman.x = 1;
   }
   else if(e.keyCode == 39 && coinsMap[pacman.y][pacman.x+1]!=9){
     pacman.x++;
   }
   //left
   else if(e.keyCode == 37 && coinsMap[pacman.y][pacman.x-1]==3){
     pacman.x = 26;
     pacman.y=15;
   }
   else if (e.keyCode == 37 && coinsMap[pacman.y][pacman.x-1]!=9){
     pacman.x--;
   }
   //up
   else if (e.keyCode == 38 && coinsMap[pacman.y-1][pacman.x]!=9){
     pacman.y--;
   }
   //down
   else if (e.keyCode == 40 && coinsMap[pacman.y+1][pacman.x]!=9){
     pacman.y++;
   }
   console.log("Pacman", pacman);
   displayPacman();
   detectCoinCollection();

 }


 function Rectangle(x, y, width, height){
   this.info = {x: x, y: y, width: width, height: height, rx: 10, ry: 10, style: "fill: blue; stroke: yellow; stroke-width: 2;"};
   this.initialize = function(){
     var rectangle = makeSVG('rect',
       { x: this.info.x,
         y: this.info.y,
         rx: this.info.rx,
         ry: this.info.ry,
         width: this.info.width,
         height: this.info.height,
         style: this.info.style
       });
    document.getElementById('svg').appendChild(rectangle);
  }
  var makeSVG = function(tag, attrs) {
        var el= document.createElementNS('http://www.w3.org/2000/svg', tag);
        for (var k in attrs)
        {
            el.setAttribute(k, attrs[k]);
        }
        boundaries.push(el);
        return el;
    } //closes makeSVG

    this.initialize();
 }

 function ObstacleL(coorda, coordb, coordc, coordd, coorde, coordf){
   this.info = {coorda: coorda, coordb: coordb, coordc: coordc, coordd: coordd, coorde: coorde, coordf: coordf, style: "fill: blue; stroke: yellow; stroke-width: 2; stroke-linejoin: round;"};
   this.initialize = function(){
     var obstacleL = makeSVG('polygon',
       { points: this.info.coorda + " " + this.info.coordb + " " + this.info.coordc + " " + this.info.coordd + " " + this.info.coorde + " " + this.info.coordf,
         style: this.info.style
       });
    document.getElementById('svg').appendChild(obstacleL);
  }
  var makeSVG = function(tag, attrs) {
        console.log("attrs", attrs);
        var el= document.createElementNS('http://www.w3.org/2000/svg', tag);
        for (var k in attrs)
        {
            el.setAttribute(k, attrs[k]);
        }
        boundaries.push(el);
        return el;
    } //closes makeSVG

    this.initialize();
 }
 function ObstacleU(coorda, coordb, coordc, coordd, coorde, coordf, coordg, coordh){
   this.info = {coorda: coorda, coordb: coordb, coordc: coordc, coordd: coordd, coorde: coorde, coordf: coordf, coordg: coordg, coordh: coordh, style: "fill: blue; stroke: yellow; stroke-width: 2; stroke-linejoin: round;"};
   this.initialize = function(){
     var obstacleL = makeSVG('polygon',
       { points: this.info.coorda + " " + this.info.coordb + " " + this.info.coordc + " " + this.info.coordd + " " + this.info.coorde + " " + this.info.coordf + " " + this.info.coordg + " " + this.info.coordh,
         style: this.info.style
       });
    document.getElementById('svg').appendChild(obstacleL);
  }
  var makeSVG = function(tag, attrs) {
        console.log("attrs", attrs);
        var el= document.createElementNS('http://www.w3.org/2000/svg', tag);
        for (var k in attrs)
        {
            el.setAttribute(k, attrs[k]);
        }
        boundaries.push(el);
        return el;
    } //closes makeSVG

    this.initialize();
 }
 ObstacleL("50, 50", "50, 195", "148, 195", "148, 150", "98, 150", "98, 50");
 ObstacleL("600, 50", "600, 150", "550, 150", "550, 195", "645, 195", "645, 50");
 ObstacleL("100, 475", "100, 570", "220, 570", "220, 525", "145, 525", "145, 475");
 ObstacleL("175, 400", "175, 495", "295, 495", "295, 450", "220, 450", "220, 400");
 ObstacleL("475, 400", "475, 450", "400, 450", "400, 495", "520, 495", "520, 400");
 ObstacleL("550, 475", "550, 525", "475, 525", "475, 570", "595, 570", "595, 475");
 ObstacleL("50, 600", "50, 720", "95, 720", "95, 645", "145, 645", "145, 600");
 ObstacleL("550, 600", "550, 645", "600, 645", "600, 720", "645, 720", "645, 600");
 //rectangle(x, y, width, height);
 Rectangle(125, 50, 95, 70);
 Rectangle(475, 50, 95, 70);
 Rectangle(25, 225, 45, 120);
 Rectangle(625, 225, 45, 145);
 Rectangle(325, 675, 45, 70);
 Rectangle(250, 600, 195, 45);
 ObstacleU("250, 50", "250, 195", "295, 195", "295, 95", "400, 95", "400, 195", "445, 195", "445, 50");
 ObstacleU("175, 150", "175, 225", "100, 225", "100, 270", "175, 270", "175, 345", "220, 345", "220, 150");
 ObstacleU("325, 125", "325, 225", "250, 225", "250, 270", "445, 270", "445, 225", "370, 225", "370, 125");
 ObstacleU("475, 150", "475, 345", "520, 345", "520, 270", "595, 270", "595, 225", "520, 225", "520, 150");
 ObstacleU("100, 300", "100, 400", "25, 400", "25, 570", "70, 570", "70, 445", "145, 445", "145, 300");
 ObstacleU("325, 450", "325, 525", "250, 525", "250, 570", "445, 570", "445, 525", "370, 525", "370, 450");
 ObstacleU("550, 300", "550, 445", "625, 445", "625, 570", "670, 570", "670, 400", "595, 400", "595, 300");
 ObstacleU("175, 600", "175, 675", "125, 675", "125, 720", "295, 720", "295, 675", "220, 675", "220, 600");
 ObstacleU("475, 600", "475, 675", "400, 675", "400, 720", "570, 720", "570, 675", "520, 675", "520, 600");


 function MakeCoin(cx, cy, r){
   this.info = {cx: cx, cy: cy, r: r, style: "fill: yellow; stroke: white; stroke-width: 1;"};
   this.initialize = function(){
     var circle = makeSVG('circle',
      {cx: this.info.cx,
       cy: this.info.cy,
       r: this.info.r,
       style: this.info.style
      });
    document.getElementById('svg').appendChild(circle);
   }
   var makeSVG = function(tag, attrs) {
         var el= document.createElementNS('http://www.w3.org/2000/svg', tag);
         for (var k in attrs)
         {
             el.setAttribute(k, attrs[k]);
         }
         coins.push(el);
         return el;
     } //closes makeSVG

     this.initialize();
 }
 var coinsMap = [
   [9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9],
   [9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,9],
   [9,1,9,9,1,9,9,9,9,1,9,9,9,9,9,9,9,9,1,9,9,9,9,1,9,9,1,9],
   [9,2,9,9,1,9,9,9,9,1,9,9,9,9,9,9,9,9,1,9,9,9,9,1,9,9,2,9],
   [9,1,9,9,1,9,9,9,9,1,9,9,1,1,1,1,9,9,1,9,9,9,9,1,9,9,1,9],
   [9,1,9,9,1,1,1,1,1,1,9,9,1,9,9,1,9,9,1,1,1,1,1,1,9,9,1,9],
   [9,1,9,9,9,9,1,9,9,1,9,9,1,9,9,1,9,9,1,9,9,1,9,9,9,9,1,9],
   [9,1,9,9,9,9,1,9,9,1,9,9,1,9,9,1,9,9,1,9,9,1,9,9,9,9,1,9],
   [9,1,1,1,1,1,1,9,9,1,1,1,1,9,9,1,1,1,1,9,9,1,1,1,1,1,1,9],
   [9,9,9,1,9,9,9,9,9,0,9,9,9,9,9,9,9,9,0,9,9,9,9,9,1,9,9,9],
   [9,9,9,1,9,9,9,9,9,0,9,9,9,9,9,9,9,9,0,9,9,9,9,9,1,9,9,9],
   [9,9,9,1,1,1,1,9,9,0,0,0,0,0,0,0,0,0,0,9,9,1,1,1,1,9,9,9],
   [9,9,9,0,9,9,1,9,9,0,9,9,9,9,9,9,9,9,0,9,9,1,9,9,0,9,9,9],
   [9,9,9,0,9,9,1,9,9,0,9,0,0,0,0,0,0,9,0,9,9,1,9,9,0,9,9,9],
   [3,0,0,0,9,9,1,0,0,0,9,0,0,0,0,0,0,9,0,0,0,1,9,9,0,9,9,9],
   [3,0,0,0,9,9,1,0,0,0,9,0,0,0,0,0,0,9,0,0,0,1,9,9,0,0,0,3],
   [9,9,9,9,9,9,1,9,9,0,9,9,9,9,9,9,9,9,0,9,9,1,9,9,9,9,9,9],
   [9,9,9,9,9,9,1,9,9,0,0,0,0,0,0,0,0,0,0,9,9,1,9,9,9,9,9,9],
   [9,9,9,1,1,1,1,9,9,9,9,9,0,9,9,0,9,9,9,9,9,1,1,1,1,9,9,9],
   [9,9,9,1,9,9,1,9,9,9,9,9,0,9,9,0,9,9,9,9,9,1,0,0,1,9,9,9],
   [9,9,9,1,9,9,1,1,1,1,0,0,0,9,9,0,0,0,1,1,1,1,0,0,1,9,9,9],
   [9,9,9,1,9,9,9,9,9,1,9,9,9,9,9,9,9,9,1,0,0,0,0,0,1,9,9,9],
   [9,9,9,1,9,9,9,9,9,1,9,9,9,9,9,9,9,9,1,0,0,0,0,0,1,9,9,9],
   [9,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,9],
   [9,1,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,1,9],
   [9,1,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,1,9],
   [9,1,0,0,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,0,0,1,9],
   [9,2,0,0,1,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,1,0,0,2,9],
   [9,1,0,0,1,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,1,0,0,1,9],
   [9,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,9]
 ]
 for (var i=0; i<coinsMap.length; i++){
   for(var j=0; j<coinsMap[i].length; j++){
     var x = 25*j+10;
     var y = 25*i+10;
     if(coinsMap[i][j] == 1){
       var r = 3;
       MakeCoin(x, y, r);
     }
     else if(coinsMap[i][j] == 2){
       var r = 7;
       MakeCoin(x, y, r);
     }
   }
 }
 // MakeCoin(35, 35, 3);
 //
 // MakeCoin(60, 35, 3);
 // MakeCoin(85, 35, 3);
 // MakeCoin(110, 35, 3);
 // MakeCoin(110, 60, 3);
 // MakeCoin(110, 85, 3);
 // MakeCoin(35, 85, 5);
 // console.log("the coin", coins[0].cx.animVal.value, coins[0].cy.animVal.value, coins[1].cx.animVal.value, coins[1].cy.animVal.value);

 function detectCoinCollection(){
   for(var i=0; i<coins.length; i++){
     if(Math.abs(coins[i].cx.animVal.value - player.style.x) <= 10 && Math.abs(coins[i].cy.animVal.value - player.style.y) <= 10){
       document.getElementById('svg').removeChild(coins[i]);
       removeAtIndex(coins, i);
     }
    // console.log("nearby?", Math.abs(coins[i].cx.animVal.value - player.style.x),Math.abs(coins[i].cy.animVal.value - player.style.y));
   }
 }

 function removeAtIndex(array, index){
   if(index == array.length-1){
     array.pop();
     return array;
   }
   else {
    var temp = array[index];
    for(var k=index; k<array.length-1; k++){
      array[k] = array[k+1];
    }
    array[array.length-1] = temp;
    array.pop();
    return array;
  }
 }

 </script>

</body>
</html>
